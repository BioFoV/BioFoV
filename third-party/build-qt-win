#!/bin/bash

################################################################################
#
# Qt5 clone and compilation
#
################################################################################

CPUS=`nproc`
SRCFLD="src-win"
DESTFLD="windows-build"

if [ ! -d qt ]; then
  mkdir qt
fi
cd qt

# Get source
if [ ! -d $SRCFLD ]; then
  if git clone git://gitorious.org/qt/qt5.git $SRCFLD;then
    echo "cloned"
  else
    echo "clone failed"
    exit
  fi
else
  cd $SRCFLD
  if git pull; then
    echo "pulled"
    cd ..
  else
    echo "pull failed"
    exit
  fi
fi

cd $SRCFLD
./init-repository
cd ..

# Build for linux
if [ ! -d $DESTFLD ]; then
  mkdir $DESTFLD
fi
cd $DESTFLD

../$SRCFLD/configure -platform linux-g++ -xplatform win32-g++ \
                 -prefix ../../windows-install/ -opensource -skip qtwebkit \
                 -force-pkg-config \
                 -release -nomake tests -nomake examples -static -confirm-license

make -j$CPUS
make install

cd .. 
