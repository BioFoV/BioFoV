#!/bin/bash

################################################################################
#
# OpenCV Git pull/clone and compilation
#
################################################################################
if [ ! -d opencv ]; then
  mkdir opencv
fi
cd opencv

# Get source
if [ ! -d src ]; then
  if git clone https://github.com/Itseez/opencv.git -b 2.4 src;then
    echo "cloned"
  else
    echo "clone failed"
    exit
  fi
else
  cd src
  if git pull; then
    echo "pulled"
    cd ..
  else
    echo "pull failed"
    exit
  fi
fi

# Build for windows
if [ ! -d windows-build ]; then
  mkdir windows-build
fi
cd windows-build
#cmake ../src/ -DCMAKE_TOOLCHAIN_FILE=../../../build_windows/Toolchain-cross-mingw32-linux.cmake
cmake -D CMAKE_BUILD_TYPE=RELEASE \
      -D CMAKE_INSTALL_PREFIX=../windows-install \
      -D CMAKE_TOOLCHAIN_FILE=../../../build-windows/Toolchain-cross-mingw32-linux.cmake \
      -D BUILD_SHARED_LIBS=OFF \
      ../src/
make install
cd ..

# Build for linux
if [ ! -d linux-build ]; then
  mkdir linux-build
fi
cd linux-build
#cmake -D WITH_CUDA=OFF ../src
cmake -D CMAKE_BUILD_TYPE=RELEASE \
      -D CMAKE_INSTALL_PREFIX=../linux-install \
      -D WITH_CUDA=OFF \
      -D BUILD_SHARED_LIBS=OFF \
      ../src/
make install
cd ../..

################################################################################
#
# Qt5 clone and compilation
#
################################################################################

if [ ! -d qt ]; then
  mkdir qt
fi
cd qt

# Get source
if [ ! -d src ]; then
  if git clone git://gitorious.org/qt/qt5.git src;then
    echo "cloned"
  else
    echo "clone failed"
    exit
  fi
else
  cd src
  if git pull; then
    echo "pulled"
    cd ..
  else
    echo "pull failed"
    exit
  fi
fi

# Build for linux
if [ ! -d build-linux ]; then
  mkdir build-linux
fi
cd build-linux
#cmake ../src/ -DCMAKE_TOOLCHAIN_FILE=../../../build_windows/Toolchain-cross-mingw32-linux.cmake
#make
cd ..

